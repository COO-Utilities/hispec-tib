# HiSPEC-TIB Application Configuration
# Copyright (c) 2025 Caltech Optical Observatories
# SPDX-License-Identifier: Apache-2.0

# General OS and logging
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_SNTP_LOG_LEVEL_DBG=y
CONFIG_NVS_LOG_LEVEL_DBG=y
CONFIG_ADC_LOG_LEVEL_DBG=y
CONFIG_GPIO_LOG_LEVEL_DBG=y

# Main thread stack (adjust as needed for networking)
CONFIG_MAIN_STACK_SIZE=2048

CONFIG_PRINTK=y
CONFIG_STDOUT_CONSOLE=y
CONFIG_POSIX_API=y

# Enable JSON
CONFIG_JSON_LIBRARY=y

# COO Commons Library with MQTT and Network support
CONFIG_COO_COMMONS=y
CONFIG_COO_NETWORK=y
CONFIG_COO_MQTT=y
CONFIG_COO_MQTT_BROKER_HOSTNAME="jebcontrol.caltech.edu"
CONFIG_COO_MQTT_BROKER_PORT="1883"
CONFIG_COO_MQTT_PAYLOAD_SIZE=256

# I2C and sensor drivers
CONFIG_I2C=y

# DAC support for attenuators (out-of-tree driver via west.yml)
CONFIG_DAC=y
CONFIG_DAC7578=y

# GPIO expander
# Note: PCAL64XXA and ADS1X1X drivers may need to be added to drivers/ or via west.yml
# Commenting out for now to allow compilation - these can be enabled once drivers are added
CONFIG_GPIO=y
# CONFIG_GPIO_PCAL64XXA=y

# ADC for photodiodes
CONFIG_ADC=y
# CONFIG_ADC_ADS1X1X=y

CONFIG_SENSOR=y
CONFIG_LED=y

# UART and Modbus for Maiman lasers
CONFIG_SERIAL=y
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_UART_LINE_CTRL=n
CONFIG_MODBUS=y
CONFIG_MODBUS_SERIAL=y
CONFIG_MODBUS_ROLE_CLIENT=y

# Storage - NVS for persistent settings
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_SETTINGS=y
CONFIG_SETTINGS_RUNTIME=y
CONFIG_NVS=y
CONFIG_SETTINGS_NVS=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# Watchdog support
CONFIG_WATCHDOG=y

# Network stack - Ethernet
CONFIG_NETWORKING=y
CONFIG_NET_LOG=y
CONFIG_NET_L2_ETHERNET=y
CONFIG_NET_TCP=y
CONFIG_NET_UDP=y
CONFIG_NET_IPV4=y
CONFIG_NET_DHCPV4=y
CONFIG_NET_IPV6=n

# W5500 Ethernet driver
CONFIG_ETH_W5500=y
CONFIG_ETH_W5500_TIMEOUT=150

# Connection manager
CONFIG_NET_CONNECTION_MANAGER=y
CONFIG_NET_HOSTNAME_ENABLE=y
CONFIG_NET_BUF_RX_COUNT=100
CONFIG_NET_MGMT_EVENT=y
CONFIG_NET_MGMT=y
CONFIG_NET_CONFIG_SETTINGS=y
CONFIG_NET_CONFIG_MY_IPV4_ADDR="192.168.1.111"
CONFIG_NET_CONFIG_MY_IPV4_NETMASK="255.255.255.0"
CONFIG_NET_CONFIG_MY_IPV4_GW="192.168.1.1"

# DNS and time sync
CONFIG_DNS_RESOLVER=y
CONFIG_SNTP=y

# Sockets for MQTT
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_SOCKOPT_TLS=n

# MQTT library
CONFIG_MQTT_LIB=y
CONFIG_MQTT_LIB_TLS=n
CONFIG_MQTT_KEEPALIVE=60
CONFIG_MQTT_VERSION_5_0=y

# Random number generation
CONFIG_ENTROPY_GENERATOR=y
CONFIG_TEST_RANDOM_GENERATOR=y

# RP2040/RP2350 specific flash support
CONFIG_FLASH_RPI_PICO=y
